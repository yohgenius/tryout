["67a6473a40db4c5347ff9699618500932fa817db","6ba3b796d45edc6273aadde6cba4e82003ad1146",["NativeEventEmitter","Platform","NativeModules","WebSocketEvent","binaryToBase64","event-target-shim","base64-js"],[69,115,161,224,272,318,361],{"version":3,"sources":["/TryOut/node_modules/react-native/Libraries/WebSocket/WebSocket.js"],"names":["NativeEventEmitter","require","Platform","RCTWebSocketModule","WebSocketModule","WebSocketEvent","binaryToBase64","EventTarget","base64","CONNECTING","OPEN","CLOSING","CLOSED","CLOSE_NORMAL","WEBSOCKET_EVENTS","nextWebSocketId","WebSocket","url","protocols","options","readyState","Array","isArray","isAvailable","Error","_eventEmitter","_socketId","_registerEvents","connect","code","reason","_close","data","send","ArrayBuffer","isView","sendBinary","ping","OS","statusCode","closeReason","close","_subscriptions","forEach","e","remove","addListener","ev","id","dispatchEvent","type","toByteArray","buffer","_unregisterEvents","message","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2015-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule WebSocket\n * @flow\n */\n'use strict';\n\nconst NativeEventEmitter = require('NativeEventEmitter');\nconst Platform = require('Platform');\nconst RCTWebSocketModule = require('NativeModules').WebSocketModule;\nconst WebSocketEvent = require('WebSocketEvent');\nconst binaryToBase64 = require('binaryToBase64');\n\nconst EventTarget = require('event-target-shim');\nconst base64 = require('base64-js');\n\nimport type EventSubscription from 'EventSubscription';\n\nconst CONNECTING = 0;\nconst OPEN = 1;\nconst CLOSING = 2;\nconst CLOSED = 3;\n\nconst CLOSE_NORMAL = 1000;\n\nconst WEBSOCKET_EVENTS = [\n  'close',\n  'error',\n  'message',\n  'open',\n];\n\nlet nextWebSocketId = 0;\n\n/**\n * Browser-compatible WebSockets implementation.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n * See https://github.com/websockets/ws\n */\nclass WebSocket extends EventTarget(...WEBSOCKET_EVENTS) {\n  static CONNECTING = CONNECTING;\n  static OPEN = OPEN;\n  static CLOSING = CLOSING;\n  static CLOSED = CLOSED;\n\n  CONNECTING: number = CONNECTING;\n  OPEN: number = OPEN;\n  CLOSING: number = CLOSING;\n  CLOSED: number = CLOSED;\n\n  _socketId: number;\n  _eventEmitter: NativeEventEmitter;\n  _subscriptions: Array<EventSubscription>;\n\n  onclose: ?Function;\n  onerror: ?Function;\n  onmessage: ?Function;\n  onopen: ?Function;\n\n  binaryType: ?string;\n  bufferedAmount: number;\n  extension: ?string;\n  protocol: ?string;\n  readyState: number = CONNECTING;\n  url: ?string;\n\n  // This module depends on the native `RCTWebSocketModule` module. If you don't include it,\n  // `WebSocket.isAvailable` will return `false`, and WebSocket constructor will throw an error\n  static isAvailable: boolean = !!RCTWebSocketModule;\n\n  constructor(url: string, protocols: ?string | ?Array<string>, options: ?{origin?: string}) {\n    super();\n    if (typeof protocols === 'string') {\n      protocols = [protocols];\n    }\n\n    if (!Array.isArray(protocols)) {\n      protocols = null;\n    }\n\n    if (!WebSocket.isAvailable) {\n      throw new Error('Cannot initialize WebSocket module. ' +\n      'Native module RCTWebSocketModule is missing.');\n    }\n\n    this._eventEmitter = new NativeEventEmitter(RCTWebSocketModule);\n    this._socketId = nextWebSocketId++;\n    this._registerEvents();\n    RCTWebSocketModule.connect(url, protocols, options, this._socketId);\n  }\n\n  close(code?: number, reason?: string): void {\n    if (this.readyState === this.CLOSING ||\n        this.readyState === this.CLOSED) {\n      return;\n    }\n\n    this.readyState = this.CLOSING;\n    this._close(code, reason);\n  }\n\n  send(data: string | ArrayBuffer | $ArrayBufferView): void {\n    if (this.readyState === this.CONNECTING) {\n      throw new Error('INVALID_STATE_ERR');\n    }\n\n    if (typeof data === 'string') {\n      RCTWebSocketModule.send(data, this._socketId);\n      return;\n    }\n\n    if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\n      RCTWebSocketModule.sendBinary(binaryToBase64(data), this._socketId);\n      return;\n    }\n\n    throw new Error('Unsupported data type');\n  }\n\n  ping(): void {\n    if (this.readyState === this.CONNECTING) {\n        throw new Error('INVALID_STATE_ERR');\n    }\n\n    RCTWebSocketModule.ping(this._socketId);\n  }\n\n  _close(code?: number, reason?: string): void {\n    if (Platform.OS === 'android') {\n      // See https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\n      const statusCode = typeof code === 'number' ? code : CLOSE_NORMAL;\n      const closeReason = typeof reason === 'string' ? reason : '';\n      RCTWebSocketModule.close(statusCode, closeReason, this._socketId);\n    } else {\n      RCTWebSocketModule.close(this._socketId);\n    }\n  }\n\n  _unregisterEvents(): void {\n    this._subscriptions.forEach(e => e.remove());\n    this._subscriptions = [];\n  }\n\n  _registerEvents(): void {\n    this._subscriptions = [\n      this._eventEmitter.addListener('websocketMessage', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        this.dispatchEvent(new WebSocketEvent('message', {\n          data: (ev.type === 'binary') ? base64.toByteArray(ev.data).buffer : ev.data\n        }));\n      }),\n      this._eventEmitter.addListener('websocketOpen', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        this.readyState = this.OPEN;\n        this.dispatchEvent(new WebSocketEvent('open'));\n      }),\n      this._eventEmitter.addListener('websocketClosed', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        this.readyState = this.CLOSED;\n        this.dispatchEvent(new WebSocketEvent('close', {\n          code: ev.code,\n          reason: ev.reason,\n        }));\n        this._unregisterEvents();\n        this.close();\n      }),\n      this._eventEmitter.addListener('websocketFailed', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        this.readyState = this.CLOSED;\n        this.dispatchEvent(new WebSocketEvent('error', {\n          message: ev.message,\n        }));\n        this.dispatchEvent(new WebSocketEvent('close', {\n          message: ev.message,\n        }));\n        this._unregisterEvents();\n        this.close();\n      })\n    ];\n  }\n}\n\nmodule.exports = WebSocket;\n"]}]